<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Querying Rows Using Core and ORM | SQLAlchemy for Python Developers</title>
    <meta name="generator" content="VuePress 1.9.7">
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-SNPCYHY4R2"></script>
    <script>window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-SNPCYHY4R2');</script>
    <meta name="description" content="This is a document that simplifies SQLAlchemy for easy understanding.">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="google-site-verification" content="wjX_mSoZBgO9SZMvjr96yOjo6n3_7pS8xNdmzDl1ESw">
    
    <link rel="preload" href="/sqlalchemy-for-pythonist/assets/css/0.styles.177fd922.css" as="style"><link rel="preload" href="/sqlalchemy-for-pythonist/assets/js/app.8473826e.js" as="script"><link rel="preload" href="/sqlalchemy-for-pythonist/assets/js/2.98979e96.js" as="script"><link rel="preload" href="/sqlalchemy-for-pythonist/assets/js/15.dca0d300.js" as="script"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/10.e7fb4c80.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/11.051ae6e1.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/12.7b93e986.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/13.8d014a70.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/14.138cd924.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/16.69771a0f.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/17.66ba2d35.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/18.760e3a59.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/19.7b4a8a4e.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/20.adec2767.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/21.c59b443d.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/22.f84628fa.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/23.2c4a7cf3.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/24.7785bb30.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/25.dc95a31e.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/26.a287ef6a.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/27.a111ddcb.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/28.b809fce0.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/29.7029d8fa.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/3.2e213720.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/30.b93101cb.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/31.363734c1.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/4.51c0545f.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/5.220df36c.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/6.345e52dd.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/7.a15a95f4.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/8.006f2d84.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/9.7948c093.js">
    <link rel="stylesheet" href="/sqlalchemy-for-pythonist/assets/css/0.styles.177fd922.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/sqlalchemy-for-pythonist/en/" class="home-link router-link-active"><!----> <span class="site-name">SQLAlchemy for Python Developers</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/SoogoonSoogoonPythonists/sqlalchemy-for-pythonist" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/sqlalchemy-for-pythonist/" class="nav-link">
  ko
</a></li><li class="dropdown-item"><!----> <a href="/sqlalchemy-for-pythonist/en/tutorial/5.1. Querying Rows Using Core and ORM.html" class="nav-link">
  en-US
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/SoogoonSoogoonPythonists/sqlalchemy-for-pythonist" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/sqlalchemy-for-pythonist/" class="nav-link">
  ko
</a></li><li class="dropdown-item"><!----> <a href="/sqlalchemy-for-pythonist/en/tutorial/5.1. Querying Rows Using Core and ORM.html" class="nav-link">
  en-US
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/sqlalchemy-for-pythonist/en/tutorial/" class="sidebar-heading clickable router-link-active open"><span>Tutorial</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/sqlalchemy-for-pythonist/en/tutorial/1. Tutorial Overview.html" class="sidebar-link">Tutorial Overview</a></li><li><a href="/sqlalchemy-for-pythonist/en/tutorial/2. Setting Up a Connection.html" class="sidebar-link">Setting up a Connection</a></li><li><a href="/sqlalchemy-for-pythonist/en/tutorial/3. Executing Transactions and Queries.html" class="sidebar-link">Executing Transactions and Queries</a></li><li><a href="/sqlalchemy-for-pythonist/en/tutorial/4. Working with Database Metadata.html" class="sidebar-link">Working with Database Metadata</a></li><li><a href="/sqlalchemy-for-pythonist/en/tutorial/5.1. Querying Rows Using Core and ORM.html" class="active sidebar-link">Querying Rows Using Core and ORM</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/sqlalchemy-for-pythonist/en/tutorial/5.1. Querying Rows Using Core and ORM.html#constructing-sql-expressions-with-select" class="sidebar-link">Constructing SQL Expressions with select()</a></li><li class="sidebar-sub-header"><a href="/sqlalchemy-for-pythonist/en/tutorial/5.1. Querying Rows Using Core and ORM.html#setting-up-the-from-clause-and-columns" class="sidebar-link">Setting up the FROM clause and columns</a></li><li class="sidebar-sub-header"><a href="/sqlalchemy-for-pythonist/en/tutorial/5.1. Querying Rows Using Core and ORM.html#where-clauses" class="sidebar-link">WHERE Clauses</a></li><li class="sidebar-sub-header"><a href="/sqlalchemy-for-pythonist/en/tutorial/5.1. Querying Rows Using Core and ORM.html#specifying-the-from-clause-and-joins" class="sidebar-link">Specifying the FROM Clause and JOINs</a></li><li class="sidebar-sub-header"><a href="/sqlalchemy-for-pythonist/en/tutorial/5.1. Querying Rows Using Core and ORM.html#order-by-group-by-having" class="sidebar-link">ORDER BY, GROUP BY, HAVING</a></li><li class="sidebar-sub-header"><a href="/sqlalchemy-for-pythonist/en/tutorial/5.1. Querying Rows Using Core and ORM.html#using-aliases" class="sidebar-link">Using aliases</a></li><li class="sidebar-sub-header"><a href="/sqlalchemy-for-pythonist/en/tutorial/5.1. Querying Rows Using Core and ORM.html#subqueries-and-cte-common-table-expression-s" class="sidebar-link">Subqueries and CTE(Common Table Expression)s</a></li><li class="sidebar-sub-header"><a href="/sqlalchemy-for-pythonist/en/tutorial/5.1. Querying Rows Using Core and ORM.html#scalar-subqueries-and-correlated-queries" class="sidebar-link">Scalar Subqueries and Correlated Queries</a></li><li class="sidebar-sub-header"><a href="/sqlalchemy-for-pythonist/en/tutorial/5.1. Querying Rows Using Core and ORM.html#union-union-all-operators" class="sidebar-link">UNION, UNION ALL operators</a></li><li class="sidebar-sub-header"><a href="/sqlalchemy-for-pythonist/en/tutorial/5.1. Querying Rows Using Core and ORM.html#exists-subqueries" class="sidebar-link">EXISTS Subqueries</a></li><li class="sidebar-sub-header"><a href="/sqlalchemy-for-pythonist/en/tutorial/5.1. Querying Rows Using Core and ORM.html#dealing-with-sql-functions" class="sidebar-link">Dealing with SQL functions.</a></li></ul></li><li><a href="/sqlalchemy-for-pythonist/en/tutorial/5.2. Inserting Rows Using Core.html" class="sidebar-link">Inserting Rows Using Core</a></li><li><a href="/sqlalchemy-for-pythonist/en/tutorial/5.3. Modifying and Deleting Rows Using Core.html" class="sidebar-link">Modifying and Deleting Rows Using Core</a></li><li><a href="/sqlalchemy-for-pythonist/en/tutorial/6. Manipulating Data Using ORM.html" class="sidebar-link">Manipulating Data Using ORM</a></li><li><a href="/sqlalchemy-for-pythonist/en/tutorial/7. Working with Related Objects Using ORM.html" class="sidebar-link">Working with Related Objects Using ORM</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="querying-rows-using-core-and-orm"><a href="#querying-rows-using-core-and-orm" class="header-anchor">#</a> Querying Rows Using <code>Core</code> and <code>ORM</code></h1> <br> <p>This chapter covers the most frequently used <code>Select</code> in SQLAlchemy.</p> <br> <h2 id="constructing-sql-expressions-with-select"><a href="#constructing-sql-expressions-with-select" class="header-anchor">#</a> Constructing SQL Expressions with <code>select()</code></h2> <p>The <code>select()</code> constructor allows you to create query statements in the same way as the <code>insert()</code> constructor.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> sqlalchemy <span class="token keyword">import</span> select
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> stmt <span class="token operator">=</span> select<span class="token punctuation">(</span>user_table<span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">'spongebob'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>stmt<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
SELECT user_account.id, user_account.name, user_account.fullname
FROM user_account
WHERE user_account.name = :name_1
&quot;&quot;&quot;</span>
</code></pre></div><p>Similarly, you can put a query in the <code>Connection.execute()</code> method to execute a query statement, just like any SQL constructor at the same level (<code>select</code>, <code>insert</code>, <code>update</code>,<code>create</code> and etc.).</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">with</span> engine<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> conn<span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">for</span> row <span class="token keyword">in</span> conn<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>stmt<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         <span class="token keyword">print</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'spongebob'</span><span class="token punctuation">,</span> <span class="token string">'Spongebob Squarepants'</span><span class="token punctuation">)</span>
</code></pre></div><p>On the other hand, if you want to use the ORM to execute a <code>select</code> query statement, you should use <code>Session.exeuct()</code>.</p> <p>The result returns a <code>Row</code> object, just like in the example just now. This object contains the <code>User</code> object that we defined in the <a href="https://soogoonsoogoonpythonists.github.io/sqlalchemy-for-pythonist/en/tutorial/4.%20Working%20with%20Database%20Metadata.html#create-a-table-object-and-add-it-to-your-metadata" target="_blank" rel="noopener noreferrer">previous tutorial<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> stmt <span class="token operator">=</span> select<span class="token punctuation">(</span>User<span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>User<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">'spongebob'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">with</span> Session<span class="token punctuation">(</span>engine<span class="token punctuation">)</span> <span class="token keyword">as</span> session<span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">for</span> row <span class="token keyword">in</span> session<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>stmt<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         <span class="token comment"># Print each row in an instance of the User object</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         <span class="token keyword">print</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span>
<span class="token punctuation">(</span>User<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'spongebob'</span><span class="token punctuation">,</span> fullname<span class="token operator">=</span><span class="token string">'Spongebob Squarepants'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
</code></pre></div><br> <h2 id="setting-up-the-from-clause-and-columns"><a href="#setting-up-the-from-clause-and-columns" class="header-anchor">#</a> Setting up the <code>FROM</code> clause and columns</h2> <p>The <code>select()</code> function can take a variety of objects as positional arguments, including <code>Column</code> and <code>Table</code>.</p> <p>These argument values can be represented as the return value of the <code>select()</code> function, i.e., as an SQL query statement, and can also set the <code>FROM</code> clause.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>select<span class="token punctuation">(</span>user_table<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
SELECT user_account.id, user_account.name, user_account.fullname
FROM user_account
&quot;&quot;&quot;</span>
</code></pre></div><p>To retrieve each column using the <code>Core</code>, you can access the <code>Column</code> object through the <code>Table.c</code> accessor.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>select<span class="token punctuation">(</span>user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>name<span class="token punctuation">,</span> user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>fullname<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
SELECT user_account.name, user_account.fullname
FROM user_account
&quot;&quot;&quot;</span>
</code></pre></div><br> <h3 id="orm-entity-and-column-lookups"><a href="#orm-entity-and-column-lookups" class="header-anchor">#</a> ORM entity and column lookups</h3> <p>When implementing SQL queries in SQLAlchemy, you can use ORM entities like the <code>User</code> object or attributes that map to columns, such as <code>User.name</code>, to represent tables or columns. The example below queries the <code>User</code> entity, but in fact, the result is the same as when using <code>user_table</code>.</p> <p>The example below looks up the <code>User</code> entity, but the results are the same as when using <code>user_table</code>.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>select<span class="token punctuation">(</span>User<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
SELECT user_account.id, user_account.name, user_account.fullname
FROM user_account
&quot;&quot;&quot;</span>
</code></pre></div><p>In the above example, the query can be executed in the same way using ORM's <code>Session.execute()</code>.</p> <p>However, there is a difference between querying the <code>User</code> entity and querying <code>user_info</code>. Whether you query <code>user_info</code> or the <code>User</code> entity, in both cases a Row object is returned.</p> <p>But, when querying the <code>User</code> entity, the returned <code>Row</code> object includes a <code>User</code> instance.</p> <blockquote><p>Tips:</p> <p>The <code>user_table</code> and <code>User</code> were created in the <a href="https://soogoonsoogoonpythonists.github.io/sqlalchemy-for-pythonist/en/tutorial/4.%20Working%20with%20Database%20Metadata.html" target="_blank" rel="noopener noreferrer">previous chapter<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>,
where <code>user_table</code> is a <code>Table</code> object, and
<code>User</code> is an entity that inherits from the <code>Base</code> object and includes a <code>Table</code> object.&quot;</p></blockquote> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">with</span> Session<span class="token punctuation">(</span>engine<span class="token punctuation">)</span> <span class="token keyword">as</span> session<span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     row <span class="token operator">=</span> session<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>select<span class="token punctuation">(</span>User<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span>
<span class="token punctuation">(</span>User<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'spongebob'</span><span class="token punctuation">,</span>fullname<span class="token operator">=</span><span class="token string">'Spongebob Squarepants'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
</code></pre></div><p>Alternatively, you can query the desired columns using object attributes(class-bound attributes).</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>select<span class="token punctuation">(</span>User<span class="token punctuation">.</span>name<span class="token punctuation">,</span> User<span class="token punctuation">.</span>fullname<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
SELECT user_account.name, user_account.fullname
FROM user_account
&quot;&quot;&quot;</span>
</code></pre></div><p>When querying object attributes using <code>Session.execute()</code>, the values of the object attributes sent as arguments (column values) are returned as follows.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">with</span> Session<span class="token punctuation">(</span>engine<span class="token punctuation">)</span> <span class="token keyword">as</span> session<span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>	row <span class="token operator">=</span> session<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>select<span class="token punctuation">(</span>User<span class="token punctuation">.</span>name<span class="token punctuation">,</span> User<span class="token punctuation">.</span>fullname<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>	<span class="token keyword">print</span><span class="token punctuation">(</span>row<span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token string">'spongebob'</span><span class="token punctuation">,</span> <span class="token string">'Spongebob Squarepants'</span><span class="token punctuation">)</span>
</code></pre></div><p>These methods can also be mixed and used together, as shown in the following example</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> session<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     select<span class="token punctuation">(</span>User<span class="token punctuation">.</span>name<span class="token punctuation">,</span> Address<span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     where<span class="token punctuation">(</span>User<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token operator">==</span>Address<span class="token punctuation">.</span>user_id<span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     order_by<span class="token punctuation">(</span>Address<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'spongebob'</span><span class="token punctuation">,</span> Address<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> email_address<span class="token operator">=</span><span class="token string">'spongebob@sqlalchemy.org'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'sandy'</span><span class="token punctuation">,</span> Address<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> email_address<span class="token operator">=</span><span class="token string">'sandy@sqlalchemy.org'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token string">'sandy'</span><span class="token punctuation">,</span> Address<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> email_address<span class="token operator">=</span><span class="token string">'sandy@squirrelpower.org'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre></div><br> <h3 id="querying-labeled-sql-expressions"><a href="#querying-labeled-sql-expressions" class="header-anchor">#</a> Querying Labeled SQL Expressions</h3> <p>When you execute a query like SELECT name AS username FROM user_account, you can get the following results:</p> <table><thead><tr><th>username</th></tr></thead> <tbody><tr><td>patrick</td></tr> <tr><td>sandy</td></tr> <tr><td>spongebob</td></tr></tbody></table> <p>Here, we've labeled the <code>name</code> column as <code>username</code>, which is why <code>username</code> appears as the column header. This functionality can be implemented in SQLAlchemy using the <code>ColumnElement.label()</code> function, as shown below:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> sqlalchemy <span class="token keyword">import</span> func<span class="token punctuation">,</span> cast
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> stmt <span class="token operator">=</span> <span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     select<span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         <span class="token comment"># Labeling is done like this.</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         <span class="token punctuation">(</span><span class="token string">&quot;Username: &quot;</span> <span class="token operator">+</span> user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span>label<span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token punctuation">)</span><span class="token punctuation">.</span>order_by<span class="token punctuation">(</span>user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">with</span> engine<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> conn<span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">for</span> row <span class="token keyword">in</span> conn<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>stmt<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         <span class="token comment"># The labeled part can be accessed like this.</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>row<span class="token punctuation">.</span>username<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
Username<span class="token punctuation">:</span> patrick
Username<span class="token punctuation">:</span> sandy
Username<span class="token punctuation">:</span> spongebob
</code></pre></div><br> <h3 id="querying-string-columns"><a href="#querying-string-columns" class="header-anchor">#</a> Querying String Columns</h3> <p>Usually, columns are queried using the <code>Select</code> object or the <code>select()</code> constructor, but sometimes you need to query a column along with an arbitrary string. This section covers how to query such string data.</p> <p>The <code>text()</code> constructor was introduced in a <a href="https://soogoonsoogoonpythonists.github.io/sqlalchemy-for-pythonist/en/tutorial/3.%20Executing%20Transactions%20and%20Queries.html" target="_blank" rel="noopener noreferrer">previous chapter 3<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Transactions and Database API Operations. It allows you to directly use a <code>SELECT</code> statement within it.</p> <p>Let's consider a scenario where we want to execute a query like <code>SELECT 'some_phrase', name FROM user_account</code>. In this case, since some_phrase is a string, it must be enclosed in either single or double quotes. Consequently, the output will inevitably have single quotes around the string.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> sqlalchemy <span class="token keyword">import</span> text
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> stmt <span class="token operator">=</span> <span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     select<span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         text<span class="token punctuation">(</span><span class="token string">&quot;'some phrase'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>name
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token punctuation">)</span><span class="token punctuation">.</span>order_by<span class="token punctuation">(</span>user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">with</span> engine<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> conn<span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span>conn<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>stmt<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'some phrase'</span><span class="token punctuation">,</span> <span class="token string">'patrick'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'some phrase'</span><span class="token punctuation">,</span> <span class="token string">'sandy'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'some phrase'</span><span class="token punctuation">,</span> <span class="token string">'spongebob'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre></div><p>Therefore, instead of <code>text()</code>, it is common to use <code>literal_column()</code> to solve the problem of having single quotes attached to the output. <code>text()</code> and <code>literal_column()</code> are almost similar, but <code>literal_column()</code> explicitly signifies a column and can be labeled for use in subqueries and other SQL expressions.&quot;</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> sqlalchemy <span class="token keyword">import</span> literal_column
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> stmt <span class="token operator">=</span> <span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     select<span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         literal_column<span class="token punctuation">(</span><span class="token string">&quot;'some phrase'&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>label<span class="token punctuation">(</span><span class="token string">&quot;p&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>name
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token punctuation">)</span><span class="token punctuation">.</span>order_by<span class="token punctuation">(</span>user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">with</span> engine<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> conn<span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">for</span> row <span class="token keyword">in</span> conn<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>stmt<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>row<span class="token punctuation">.</span>p<span class="token punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token punctuation">{</span>row<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
some phrase<span class="token punctuation">,</span> patrick
some phrase<span class="token punctuation">,</span> sandy
some phrase<span class="token punctuation">,</span> spongebob

</code></pre></div><br> <h2 id="where-clauses"><a href="#where-clauses" class="header-anchor">#</a> <code>WHERE</code> Clauses</h2> <p>Using SQLAlchemy, you can easily write queries to output data where conditions like <code>name = 'thead'</code> or <code>user_id &gt; 10</code> are met using Python operators.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">'squidward'</span><span class="token punctuation">)</span>
user_account<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token punctuation">:</span>name_1

<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>address_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>user_id <span class="token operator">&gt;</span> <span class="token number">10</span><span class="token punctuation">)</span>
address<span class="token punctuation">.</span>user_id <span class="token operator">&gt;</span> <span class="token punctuation">:</span>user_id_1
</code></pre></div><p>To create a <code>WHERE</code> clause, you can pass arguments to the <code>Select.where()</code> method.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>select<span class="token punctuation">(</span>user_table<span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">'squidward'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
SELECT user_account.id, user_account.name, user_account.fullname
FROM user_account
WHERE user_account.name = :name_1
&quot;&quot;&quot;</span>
</code></pre></div><p>When implementing a <code>JOIN</code> with a <code>WHERE</code> clause, it can be written as follows.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         select<span class="token punctuation">(</span>address_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>email_address<span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         where<span class="token punctuation">(</span>user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">'squidward'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         where<span class="token punctuation">(</span>address_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>user_id <span class="token operator">==</span> user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
SELECT address.email_address
FROM address, user_account
WHERE user_account.name = :name_1 AND address.user_id = user_account.id
&quot;&quot;&quot;</span>

<span class="token comment"># The same expression can be used, but you can also pass parameters to the where() method.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>
        select<span class="token punctuation">(</span>address_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>email_address<span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         where<span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>             user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">'squidward'</span><span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>             address_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>user_id <span class="token operator">==</span> user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span><span class="token builtin">id</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         <span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
SELECT address.email_address
FROM address, user_account
WHERE user_account.name = :name_1 AND address.user_id = user_account.id
&quot;&quot;&quot;</span>
</code></pre></div><p>It's also possible to use conjunctions such as <code>and_()</code> and <code>or_()</code>.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> sqlalchemy <span class="token keyword">import</span> and_<span class="token punctuation">,</span> or_
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     select<span class="token punctuation">(</span>Address<span class="token punctuation">.</span>email_address<span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         where<span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>             and_<span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                 or_<span class="token punctuation">(</span>User<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">'squidward'</span><span class="token punctuation">,</span> User<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">'sandy'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>                 Address<span class="token punctuation">.</span>user_id <span class="token operator">==</span> User<span class="token punctuation">.</span><span class="token builtin">id</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>             <span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         <span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>  <span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
SELECT address.email_address
FROM address, user_account
WHERE (user_account.name = :name_1 OR user_account.name = :name_2)
AND address.user_id = user_account.id
&quot;&quot;&quot;</span>
</code></pre></div><p>For simple equality or inequality comparisons, <code>Select.filter_by()</code> is often used.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     select<span class="token punctuation">(</span>User<span class="token punctuation">)</span><span class="token punctuation">.</span>filter_by<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'spongebob'</span><span class="token punctuation">,</span> fullname<span class="token operator">=</span><span class="token string">'Spongebob Squarepants'</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
SELECT user_account.id, user_account.name, user_account.fullname
FROM user_account
WHERE user_account.name = :name_1 AND user_account.fullname = :fullname_1
&quot;&quot;&quot;</span>
</code></pre></div><br> <h2 id="specifying-the-from-clause-and-joins"><a href="#specifying-the-from-clause-and-joins" class="header-anchor">#</a> Specifying the <code>FROM</code> Clause and <code>JOIN</code>s</h2> <p>As mentioned before, the <code>FROM</code> clause is automatically set based on the columns included as arguments in the <code>select()</code> method, without the need for explicit specification.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment">#     Even without specifying the FROM clause explicitly, it is set and displayed in the output.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>select<span class="token punctuation">(</span>user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
SELECT user_account.name
FROM user_account
&quot;&quot;&quot;</span>
</code></pre></div><p>If you want to reference columns from two different tables in the positional arguments of <code>select()</code>, you can separate them with a comma (<code>,</code>).</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>select<span class="token punctuation">(</span>user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>name<span class="token punctuation">,</span> address_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>email_address<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
SELECT user_account.name, address.email_address
FROM user_account, address
&quot;&quot;&quot;</span>
</code></pre></div><p>If you want to join two different tables, there are two methods you can use:</p> <p>One is the <code>Select.join()</code> method, which allows you to explicitly specify the left and right tables for the <code>JOIN</code>.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     select<span class="token punctuation">(</span>user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>name<span class="token punctuation">,</span> address_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>email_address<span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     join_from<span class="token punctuation">(</span>user_table<span class="token punctuation">,</span> address_table<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
SELECT user_account.name, address.email_address
FROM user_account JOIN address ON user_account.id = address.user_id
&quot;&quot;&quot;</span>
</code></pre></div><p>The other is to explicitly specify only the right table in the <code>Select.join()</code> method, and let the other table be implicitly referenced when selecting columns.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># This expression is the same, but the left table to join (user_table) is expressed implicitly.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     select<span class="token punctuation">(</span>user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>name<span class="token punctuation">,</span> address_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>email_address<span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     join<span class="token punctuation">(</span>address_table<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
SELECT user_account.name, address.email_address
FROM user_account JOIN address ON user_account.id = address.user_id
&quot;&quot;&quot;</span>
</code></pre></div><p>Alternatively, if you want to write the two JOINing tables more explicitly, or if you want to provide explicit additional options in the <code>FROM</code> clause, you can write it as follows.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     select<span class="token punctuation">(</span>address_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>email_address<span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     select_from<span class="token punctuation">(</span>user_table<span class="token punctuation">)</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>address_table<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
SELECT address.email_address
FROM user_account JOIN address ON user_account.id = address.user_id
&quot;&quot;&quot;</span>
</code></pre></div><p>Another case for using <code>Select.select_from()</code> is when we cannot implicitly set the <code>FROM</code> clause through the columns we want to query.</p> <p>For example, to query <code>count(*)</code> in a typical SQL query, you would need to use <code>sqlalchemy.sql.expression.func</code> from SQLAlchemy.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> sqlalchemy <span class="token keyword">import</span> func
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>select<span class="token punctuation">(</span>func<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token string">'*'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>select_from<span class="token punctuation">(</span>user_table<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
SELECT count(:count_2) AS count_1
FROM user_account
&quot;&quot;&quot;</span>
</code></pre></div><br> <h3 id="setting-the-on-clause"><a href="#setting-the-on-clause" class="header-anchor">#</a> Setting the <code>ON</code> Clause</h3> <p>But there was something unusual, wasn't there?
In fact, in the previous example, when joining two tables using <code>Select.select_from()</code> or <code>select.join()</code>, the <code>ON</code> clause was implicitly set.</p> <p>This automatic setting of the <code>ON</code> clause happened because the <code>user_table</code> and <code>address_table</code> objects have a ForeignKeyConstraint, i.e., a foreign key constraint, which led to the automatic setting.</p> <p>If the two tables targeted for a Join lack such constraint keys, you must explicitly specify the <code>ON</code> clause. This functionality can be explicitly set by passing parameters to the <code>Select.join()</code> or <code>Select.join_from()</code> methods for the <code>ON</code> clause.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     select<span class="token punctuation">(</span>address_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>email_address<span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     select_from<span class="token punctuation">(</span>user_table<span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     join<span class="token punctuation">(</span>address_table<span class="token punctuation">,</span> user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token operator">==</span> address_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>user_id<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
SELECT address.email_address
FROM user_account JOIN address ON user_account.id = address.user_id
&quot;&quot;&quot;</span>
</code></pre></div><br> <h3 id="outer-full-join"><a href="#outer-full-join" class="header-anchor">#</a> OUTER, FULL Join</h3> <p>To implement <code>LEFT OUTER JOIN</code> or <code>FULL OUTER JOIN</code> In SQLAlchemy, you can use the keyword arguments <code>Select.join.isouter</code> and <code>Select.join.full</code> in the <code>Select.join()</code> and <code>Select.join_from()</code> methods.</p> <p>An examples of implementing the <code>LEFT OUTER JOIN</code>:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     select<span class="token punctuation">(</span>user_table<span class="token punctuation">)</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>address_table<span class="token punctuation">,</span> isouter<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
SELECT user_account.id, user_account.name, user_account.fullname
FROM user_account LEFT OUTER JOIN address ON user_account.id = address.user_id
&quot;&quot;&quot;</span>
</code></pre></div><p>An examples of implementing the <code>FULL OUTER JOIN</code>:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     select<span class="token punctuation">(</span>user_table<span class="token punctuation">)</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>address_table<span class="token punctuation">,</span> full<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
SELECT user_account.id, user_account.name, user_account.fullname
FROM user_account FULL OUTER JOIN address ON user_account.id = address.user_id
&quot;&quot;&quot;</span>
</code></pre></div><br> <h2 id="order-by-group-by-having"><a href="#order-by-group-by-having" class="header-anchor">#</a> ORDER BY, GROUP BY, HAVING</h2> <ul><li>The <code>ORDER BY</code> clause allows you to set the order of the rows retrieved by the <code>SELECT</code> clause.</li> <li>The <code>GROUP BY</code> clause creates groups based on a specific column for rows aggregated by group functions.</li> <li><code>HAVING</code> applies conditions to groups created by the <code>GROUP BY</code> clause.</li></ul> <br> <h3 id="order-by"><a href="#order-by" class="header-anchor">#</a> ORDER BY</h3> <p>You can implement the ORDER BY feature using <code>Select.order_by()</code>. This method accepts Column objects or similar objects as positional arguments.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>select<span class="token punctuation">(</span>user_table<span class="token punctuation">)</span><span class="token punctuation">.</span>order_by<span class="token punctuation">(</span>user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
SELECT user_account.id, user_account.name, user_account.fullname
FROM user_account ORDER BY user_account.name
&quot;&quot;&quot;</span>
</code></pre></div><p>Ascending and descending order can be implemented using the <code>ColumnElement.asc()</code> and <code>ColumnElement.desc()</code> modifiers, respectively.</p> <p>The following example orders by the <code>user_account.fullname</code> column in descending order.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>select<span class="token punctuation">(</span>User<span class="token punctuation">)</span><span class="token punctuation">.</span>order_by<span class="token punctuation">(</span>User<span class="token punctuation">.</span>fullname<span class="token punctuation">.</span>desc<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
SELECT user_account.id, user_account.name, user_account.fullname
FROM user_account ORDER BY user_account.fullname DESC
&quot;&quot;&quot;</span>
</code></pre></div><br> <h3 id="aggregations-group-by-having"><a href="#aggregations-group-by-having" class="header-anchor">#</a> Aggregations: GROUP BY, HAVING</h3> <p>In SQL, aggregate functions can also be used to combine multiple rows into a single row. Examples of aggregate functions include <code>COUNT()</code>, <code>SUM()</code>, and <code>AVG()</code>.</p> <p>SQLAlchemy provides SQL functions using the func namespace, where <code>func</code> creates a <code>Function</code> instance when given the name of an SQL function.</p> <p>In the example below, the <code>count()</code> function is called to render the <code>user_account.id</code> column with the SQL <code>COUNT()</code> function.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> sqlalchemy <span class="token keyword">import</span> func
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> count_fn <span class="token operator">=</span> func<span class="token punctuation">.</span>count<span class="token punctuation">(</span>user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>count_fn<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
count(user_account.id)
&quot;&quot;&quot;</span>
</code></pre></div><p>More details about SQL functions are explained in <a href="">Handling SQL Functions</a>.</p> <p>To summarize:</p> <p><code>GROUP BY</code> is a function needed to divide the retrieved rows into specific groups. In SQL, if a few columns are queried in the <code>SELECT</code> clause, these columns are directly or indirectly dependent on the primary key in the <code>GROUP BY</code>.</p> <p><code>HAVING</code> is necessary to apply conditions to groups created by <code>GROUP BY</code> (similar to the <code>WHERE</code> clause because it places conditions on groups).</p> <p>In SQLAlchemy, <code>GROUP BY</code> and <code>HAVING</code> can be implemented using <code>Select.group_by()</code> and <code>Select.having()</code>.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">with</span> engine<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> conn<span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     result <span class="token operator">=</span> conn<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         select<span class="token punctuation">(</span>User<span class="token punctuation">.</span>name<span class="token punctuation">,</span> func<span class="token punctuation">.</span>count<span class="token punctuation">(</span>Address<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">.</span>label<span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         join<span class="token punctuation">(</span>Address<span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         group_by<span class="token punctuation">(</span>User<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         having<span class="token punctuation">(</span>func<span class="token punctuation">.</span>count<span class="token punctuation">(</span>Address<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot; The syntax above represents the SQL statement below.
SELECT user_account.name, count(address.id) AS count
FROM user_account JOIN address ON user_account.id = address.user_id GROUP BY user_account.name
HAVING count(address.id) &gt; ?
[...] (1,)
&quot;&quot;&quot;</span>

<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'sandy'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre></div><br> <h3 id="grouping-or-ordering-by-alias"><a href="#grouping-or-ordering-by-alias" class="header-anchor">#</a> Grouping or ordering by alias</h3> <p>In some database backends, when using aggregate functions to query tables, it is important not to <strong>restate</strong> already specified aggregate functions in the <code>ORDER BY</code> or <code>GROUP BY</code> clauses.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># NOT GOOD</span>
<span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">FROM</span> user_account <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> id <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token function">count</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>

<span class="token comment"># CORRECT</span>
<span class="token keyword">SELECT</span> id<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span> <span class="token keyword">as</span> cnt_id <span class="token keyword">FROM</span> user_account <span class="token keyword">GROUP</span> <span class="token keyword">BY</span> id <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> cnt_id
</code></pre></div><p>Therefore, to implement <code>ORDER BY</code> or <code>GROUP BY</code> using aliases, you just need to insert the alias you want to use as an argument in the <code>Select.order_by()</code> or <code>Select.group_by()</code> methods.</p> <p>The alias used here is not rendered first; instead, the alias used in the column clause is rendered first. If the rendered alias does not match anything in the rest of the query, an error occurs.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> sqlalchemy <span class="token keyword">import</span> func<span class="token punctuation">,</span> desc
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token comment"># The alias 'num_addresses' is used in both the column and in the order_by clause.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> stmt <span class="token operator">=</span> select<span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         Address<span class="token punctuation">.</span>user_id<span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         func<span class="token punctuation">.</span>count<span class="token punctuation">(</span>Address<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">.</span>label<span class="token punctuation">(</span><span class="token string">'num_addresses'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>\
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         group_by<span class="token punctuation">(</span><span class="token string">&quot;user_id&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>order_by<span class="token punctuation">(</span><span class="token string">&quot;user_id&quot;</span><span class="token punctuation">,</span> desc<span class="token punctuation">(</span><span class="token string">&quot;num_addresses&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>stmt<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
SELECT address.user_id, count(address.id) AS num_addresses
FROM address GROUP BY address.user_id ORDER BY address.user_id, num_addresses DESC
&quot;&quot;&quot;</span>
</code></pre></div><br> <h2 id="using-aliases"><a href="#using-aliases" class="header-anchor">#</a> Using aliases</h2> <p>When using <code>JOIN</code> to query multiple tables, it's often necessary to repeatedly write the table names in the query.</p> <p>In SQL, this issue can be addressed by giving <em>aliases</em> to table names or subqueries, reducing repetition.</p> <p>In SQLAlchemy, such aliases can be implemented using the Core's <code>FromClause.alias()</code> function.</p> <p>Within the <code>Table</code> object namespace, there are <code>Column</code> objects, allowing access to column names via <code>Table.c</code>.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">print</span><span class="token punctuation">(</span>select<span class="token punctuation">(</span>user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>name<span class="token punctuation">,</span> user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>fullname<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
SELECT user_account.name, user_account.fullname
FROM user_account
&quot;&quot;&quot;</span>
</code></pre></div><p>Similarly, in the <code>Alias</code> object namespace, there are <code>Column</code> objects, making it possible to access columns via <code>Alias.c</code>.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token comment"># Both user_alias_1 and user_alias_2 are Alias objects.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> user_alias_1 <span class="token operator">=</span> user_table<span class="token punctuation">.</span>alias<span class="token punctuation">(</span>table1<span class="token punctuation">)</span> 
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> user_alias_2 <span class="token operator">=</span> user_table<span class="token punctuation">.</span>alias<span class="token punctuation">(</span>table2<span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token comment"># To access columns using the newly created table aliases,</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token comment"># you should use Alias.c.column_name</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     select<span class="token punctuation">(</span>user_alias_1<span class="token punctuation">.</span>c<span class="token punctuation">.</span>name<span class="token punctuation">,</span> user_alias_2<span class="token punctuation">.</span>c<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     join_from<span class="token punctuation">(</span>user_alias_1<span class="token punctuation">,</span> user_alias_2<span class="token punctuation">,</span> user_alias_1<span class="token punctuation">.</span>c<span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token operator">&gt;</span> user_alias_2<span class="token punctuation">.</span>c<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;
SELECT table1.name, table2.name AS name_1 
FROM user_account AS table1 JOIN user_account AS table2 ON table1.id &gt; table2.id
&quot;&quot;&quot;</span>
</code></pre></div><br> <h3 id="orm-entity-aliases"><a href="#orm-entity-aliases" class="header-anchor">#</a> ORM Entity Aliases</h3> <p>The ORM in SQLAlchemy also has a function similar to the <code>FromClause.alias()</code> method, known as <code>aliased()</code></p> <p>This ORM <code>aliased()</code> function internally creates an <code>Alias</code> object for the originally mapped <code>Table</code> object, while maintaining ORM functionalities.</p> <blockquote><p>Tips:</p> <p>The <code>user_table</code> and <code>User</code> were created in the <a href="https://soogoonsoogoonpythonists.github.io/sqlalchemy-for-pythonist/en/tutorial/4.%20Working%20with%20Database%20Metadata.html" target="_blank" rel="noopener noreferrer">previous chapter<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>,
where <code>user_table</code> is a <code>Table</code> object, and
<code>User</code> is an entity that inherits from the <code>Base</code> object and includes a <code>Table</code> object.&quot;</p></blockquote> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> user_alias_1 <span class="token operator">=</span> user_table<span class="token punctuation">.</span>alias<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> user_alias_2 <span class="token operator">=</span> user_table<span class="token punctuation">.</span>alias<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token comment"># In the examples, it is applied to the User or Address entities.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     select<span class="token punctuation">(</span>User<span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     join_from<span class="token punctuation">(</span>User<span class="token punctuation">,</span> address_alias_1<span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     where<span class="token punctuation">(</span>address_alias_1<span class="token punctuation">.</span>email_address <span class="token operator">==</span> <span class="token string">'patrick@aol.com'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     join_from<span class="token punctuation">(</span>User<span class="token punctuation">,</span> address_alias_2<span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     where<span class="token punctuation">(</span>address_alias_2<span class="token punctuation">.</span>email_address <span class="token operator">==</span> <span class="token string">'patrick@gmail.com'</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
SELECT user_account.id, user_account.name, user_account.fullname 
FROM user_account JOIN address AS address_1 ON user_account.id = address_1.user_id JOIN address AS address_2 ON user
&quot;&quot;&quot;</span>
</code></pre></div><br> <h2 id="subqueries-and-cte-common-table-expression-s"><a href="#subqueries-and-cte-common-table-expression-s" class="header-anchor">#</a> Subqueries and CTE(Common Table Expression)s</h2> <p>This section explains subqueries typically found in the <code>FROM</code> clause of a <code>SELECT</code> statement. It also covers CTEs (Common Table Expressions), which are used in a similar way to subqueries but with additional functionalities.</p> <blockquote><p>More about CTE</p> <p>A CTE is a temporary result set within a query that can be referenced multiple times within the same query.
You can check the official links to describe CTEs in RDBMS below.</p> <ul><li><a href="https://www.postgresql.org/docs/current/queries-with.html" target="_blank" rel="noopener noreferrer">PostgreSQL: WITH Queries (Common Table Expressions)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://dev.mysql.com/doc/refman/8.0/en/with.html" target="_blank" rel="noopener noreferrer">MySQL: WITH (Common Table Expressions)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://mariadb.com/kb/en/with/" target="_blank" rel="noopener noreferrer">MariaDB: WITH<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></blockquote> <p>SQLAlchemy represents subqueries using the <code>Subquery</code> object created by <code>Select.subquery()</code>, and CTEs are represented using <code>Select.cte()</code>.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> subq <span class="token operator">=</span> select<span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     func<span class="token punctuation">.</span>count<span class="token punctuation">(</span>address_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">.</span>label<span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     address_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>user_id
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>group_by<span class="token punctuation">(</span>address_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>user_id<span class="token punctuation">)</span><span class="token punctuation">.</span>subquery<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>subq<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
SELECT count(address.id) AS count, address.user_id
FROM address GROUP BY address.user_id
&quot;&quot;&quot;</span>

<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token comment"># The ON clause automatically binds two tables</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token comment"># that are already constrained by a foreign key.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> stmt <span class="token operator">=</span> select<span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>fullname<span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    subq<span class="token punctuation">.</span>c<span class="token punctuation">.</span>count
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>join_from<span class="token punctuation">(</span>user_table<span class="token punctuation">,</span> subq<span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>stmt<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
SELECT user_account.name, user_account.fullname, anon_1.count
FROM user_account JOIN (SELECT count(address.id) AS count, address.user_id AS user_id
FROM address GROUP BY address.user_id) AS anon_1 ON user_account.id = anon_1.user_id
&quot;&quot;&quot;</span>
</code></pre></div><br> <h3 id="hierarchy-query"><a href="#hierarchy-query" class="header-anchor">#</a> Hierarchy Query</h3> <p>The method of using CTE syntax in SQLAlchemy is almost identical to how subquery syntax is used. Instead of calling the <code>Select.subquery()</code> method, you use <code>Select.cte()</code>, allowing the resulting object to be used as a FROM element.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> subq <span class="token operator">=</span> select<span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     func<span class="token punctuation">.</span>count<span class="token punctuation">(</span>address_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">.</span>label<span class="token punctuation">(</span><span class="token string">&quot;count&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     address_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>user_id
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>group_by<span class="token punctuation">(</span>address_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>user_id<span class="token punctuation">)</span><span class="token punctuation">.</span>cte<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> stmt <span class="token operator">=</span> select<span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>fullname<span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>    subq<span class="token punctuation">.</span>c<span class="token punctuation">.</span>count
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>join_from<span class="token punctuation">(</span>user_table<span class="token punctuation">,</span> subq<span class="token punctuation">)</span>

<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>stmt<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
WITH anon_1 AS
(SELECT count(address.id) AS count, address.user_id AS user_id
FROM address GROUP BY address.user_id)
 SELECT user_account.name, user_account.fullname, anon_1.count
FROM user_account JOIN anon_1 ON user_account.id = anon_1.user_id
&quot;&quot;&quot;</span>
</code></pre></div><br> <h3 id="orm-entity-subqueries-cte"><a href="#orm-entity-subqueries-cte" class="header-anchor">#</a> ORM Entity Subqueries, CTE</h3> <p>You can see that <code>aliased()</code> performs the same operation for <code>Subquery</code> and <code>CTE</code> subqueries.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> subq <span class="token operator">=</span> select<span class="token punctuation">(</span>Address<span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span><span class="token operator">~</span>Address<span class="token punctuation">.</span>email_address<span class="token punctuation">.</span>like<span class="token punctuation">(</span><span class="token string">'%@aol.com'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>subquery<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> address_subq <span class="token operator">=</span> aliased<span class="token punctuation">(</span>Address<span class="token punctuation">,</span> subq<span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> stmt <span class="token operator">=</span> select<span class="token punctuation">(</span>User<span class="token punctuation">,</span> address_subq<span class="token punctuation">)</span><span class="token punctuation">.</span>join_from<span class="token punctuation">(</span>User<span class="token punctuation">,</span> address_subq<span class="token punctuation">)</span><span class="token punctuation">.</span>order_by<span class="token punctuation">(</span>User<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span> address_subq<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">with</span> Session<span class="token punctuation">(</span>engine<span class="token punctuation">)</span> <span class="token keyword">as</span> session<span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">for</span> user<span class="token punctuation">,</span> address <span class="token keyword">in</span> session<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>stmt<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>user<span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{</span>address<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot; The above syntax represents the following query:

SELECT user_account.id, user_account.name, user_account.fullname,
anon_1.id AS id_1, anon_1.email_address, anon_1.user_id
FROM user_account JOIN
(SELECT address.id AS id, address.email_address AS email_address, address.user_id AS user_id
FROM address
WHERE address.email_address NOT LIKE ?) AS anon_1 ON user_account.id = anon_1.user_id
ORDER BY user_account.id, anon_1.id
[...] ('%@aol.com',)
&quot;&quot;&quot;</span>

User<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'spongebob'</span><span class="token punctuation">,</span> fullname<span class="token operator">=</span><span class="token string">'Spongebob Squarepants'</span><span class="token punctuation">)</span> Address<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> email_address<span class="token operator">=</span><span class="token string">'spongebob@sqlalchemy.org'</span><span class="token punctuation">)</span>
User<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'sandy'</span><span class="token punctuation">,</span> fullname<span class="token operator">=</span><span class="token string">'Sandy Cheeks'</span><span class="token punctuation">)</span> Address<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> email_address<span class="token operator">=</span><span class="token string">'sandy@sqlalchemy.org'</span><span class="token punctuation">)</span>
User<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'sandy'</span><span class="token punctuation">,</span> fullname<span class="token operator">=</span><span class="token string">'Sandy Cheeks'</span><span class="token punctuation">)</span> Address<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> email_address<span class="token operator">=</span><span class="token string">'sandy@squirrelpower.org'</span><span class="token punctuation">)</span>
</code></pre></div><p>Below is an example of querying the same result using the CTE constructor:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> cte <span class="token operator">=</span> select<span class="token punctuation">(</span>Address<span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span><span class="token operator">~</span>Address<span class="token punctuation">.</span>email_address<span class="token punctuation">.</span>like<span class="token punctuation">(</span><span class="token string">'%@aol.com'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cte<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> address_cte <span class="token operator">=</span> aliased<span class="token punctuation">(</span>Address<span class="token punctuation">,</span> cte<span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> stmt <span class="token operator">=</span> select<span class="token punctuation">(</span>User<span class="token punctuation">,</span> address_cte<span class="token punctuation">)</span><span class="token punctuation">.</span>join_from<span class="token punctuation">(</span>User<span class="token punctuation">,</span> address_cte<span class="token punctuation">)</span><span class="token punctuation">.</span>order_by<span class="token punctuation">(</span>User<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span> address_cte<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">with</span> Session<span class="token punctuation">(</span>engine<span class="token punctuation">)</span> <span class="token keyword">as</span> session<span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">for</span> user<span class="token punctuation">,</span> address <span class="token keyword">in</span> session<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>stmt<span class="token punctuation">)</span><span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f&quot;</span><span class="token interpolation"><span class="token punctuation">{</span>user<span class="token punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token punctuation">{</span>address<span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>

User<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'spongebob'</span><span class="token punctuation">,</span> fullname<span class="token operator">=</span><span class="token string">'Spongebob Squarepants'</span><span class="token punctuation">)</span> Address<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> email_address<span class="token operator">=</span><span class="token string">'spongebob@sqlalchemy.org'</span><span class="token punctuation">)</span>
User<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'sandy'</span><span class="token punctuation">,</span> fullname<span class="token operator">=</span><span class="token string">'Sandy Cheeks'</span><span class="token punctuation">)</span> Address<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> email_address<span class="token operator">=</span><span class="token string">'sandy@sqlalchemy.org'</span><span class="token punctuation">)</span>
User<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'sandy'</span><span class="token punctuation">,</span> fullname<span class="token operator">=</span><span class="token string">'Sandy Cheeks'</span><span class="token punctuation">)</span> Address<span class="token punctuation">(</span><span class="token builtin">id</span><span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> email_address<span class="token operator">=</span><span class="token string">'sandy@squirrelpower.org'</span><span class="token punctuation">)</span>
</code></pre></div><br> <h2 id="scalar-subqueries-and-correlated-queries"><a href="#scalar-subqueries-and-correlated-queries" class="header-anchor">#</a> Scalar Subqueries and Correlated Queries</h2> <p>Before explaining scalar subqueries, let's briefly discuss subqueries in SQL. <a href="https://rinuas.tistory.com/entry/%EC%84%9C%EB%B8%8C%EC%BF%BC%EB%A6%ACSub-Query" target="_blank" rel="noopener noreferrer">: <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>A &quot;<em>subquery</em>&quot; is a <code>SELECT</code> statement within another SQL statement, and the outer SQL statement is referred to as the &quot;<em>main query</em>&quot;.</p> <p>The types of subqueries are determined based on whether they reference columns of the main query, where they are declared, and the number of rows they return.</p> <ul><li>Classification based on reference to main query columns:
<ul><li><strong>Correlated Subqueries</strong>: The subquery references columns of the main query.</li> <li><strong>Non-correlated Subqueries</strong>: The subquery does not reference the main query's columns and operates independently, used to convey information to the main query.</li></ul></li> <li>Classification based on declaration position:
<ul><li><strong>Scalar Subqueries</strong>: Subqueries that appear in the column position of a SELECT statement (correlated).</li> <li><strong>Inline Views</strong>: Subqueries in the FROM clause (correlated).</li> <li><strong>Nested Subqueries</strong>: Subqueries in the WHERE clause (non-correlated).</li></ul></li> <li>Classification based on the number of rows returned:
<ul><li><strong>Single-row Subqueries</strong> (return one row)</li> <li><strong>Multi-row Subqueries</strong> (return more than one row): Used with IN, ANY, ALL, EXISTS.</li></ul></li></ul> <br> <p>In SQLAlchemy, scalar subqueries use <code>ScalarSelect</code>, which is part of the <code>ColumnElement</code> object, while general subqueries use <code>Subquery</code>, which is in the <code>FromClause</code> object.</p> <p>Scalar subqueries are often used as described earlier in <a href="#aggregations-group-by-having">Aggregations</a>.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># Implementing Scalar subquery using Select.scalar_subquery()</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> subq <span class="token operator">=</span> select<span class="token punctuation">(</span>func<span class="token punctuation">.</span>count<span class="token punctuation">(</span>address_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>             where<span class="token punctuation">(</span>user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token operator">==</span> address_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>user_id<span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>             scalar_subquery<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>subq<span class="token punctuation">)</span> <span class="token comment"># ... is equal to &quot;ScalarSelect&quot; type</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
(SELECT count(address.id) AS count_1
FROM address, user_account
WHERE user_account.id = address.user_id)
&quot;&quot;&quot;</span>
</code></pre></div><p>Scalar subqueries implemented using <code>Select.scalar_subquery()</code> render the <code>user_account</code> and <code>address</code> in the FROM clause, but since the <code>user_account</code> table is already present in the main query, it is not rendered again in the scalar subquery.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> stmt <span class="token operator">=</span> select<span class="token punctuation">(</span>user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>name<span class="token punctuation">,</span> subq<span class="token punctuation">.</span>label<span class="token punctuation">(</span><span class="token string">&quot;address_count&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>stmt<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
SELECT user_account.name, (SELECT count(address.id) AS count_1
FROM address
WHERE user_account.id = address.user_id) AS address_count
FROM user_account
&quot;&quot;&quot;</span>
</code></pre></div><p>Meanwhile, when writing correlated queries, the connections between tables can become ambiguous.</p> <blockquote><p>I did not understand the correlated query example in the tutorial.
If someone understands it well, please contribute to this document.</p></blockquote> <br> <h2 id="union-union-all-operators"><a href="#union-union-all-operators" class="header-anchor">#</a> UNION, UNION ALL operators</h2> <p>In SQL, terms like <code>UNION</code> and <code>UNION ALL</code> are used to combine two <code>SELECT</code> statements.
Queries can be executed as shown below.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> id <span class="token keyword">FROM</span> user_account
<span class="token keyword">union</span> 
<span class="token keyword">SELECT</span> email_address <span class="token keyword">FROM</span> address
</code></pre></div><p>Additionally, SQL supports set operations like <code>INTERSECT</code> (intersection) and <code>EXCEPT</code> (difference).
In SQLAlchemy, for Select objects, functions such as <code>union()</code>, <code>intersect()</code>, <code>except_()</code>, <code>union_all()</code>, <code>intersect_all()</code>, and <code>except_all()</code> are available.</p> <p>The return value of these functions is a <code>CompoundSelect</code>, which is an object that can be used similarly to <code>Select</code> but has fewer methods.
The <code>CompoundSelect</code> object returned by <code>union_all()</code> can be executed with <code>Connection.execute()</code>.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> sqlalchemy <span class="token keyword">import</span> union_all
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> stmt1 <span class="token operator">=</span> select<span class="token punctuation">(</span>user_table<span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">'sandy'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> stmt2 <span class="token operator">=</span> select<span class="token punctuation">(</span>user_table<span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">'spongebob'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> u <span class="token operator">=</span> union_all<span class="token punctuation">(</span>stmt1<span class="token punctuation">,</span> stmt2<span class="token punctuation">)</span> <span class="token comment"># A value u is a CompoundSelect type.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">with</span> engine<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> conn<span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     result <span class="token operator">=</span> conn<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>u<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'sandy'</span><span class="token punctuation">,</span> <span class="token string">'Sandy Cheeks'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'spongebob'</span><span class="token punctuation">,</span> <span class="token string">'Spongebob Squarepants'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre></div><p>Just as <code>Select</code> provides the <code>SelectBase.subquery()</code> method to create <code>Subquery</code> objects, <code>CompoundSelect</code> objects can similarly be used as subqueries.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> u_subq <span class="token operator">=</span> u<span class="token punctuation">.</span>subquery<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> stmt <span class="token operator">=</span> <span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     select<span class="token punctuation">(</span>u_subq<span class="token punctuation">.</span>c<span class="token punctuation">.</span>name<span class="token punctuation">,</span> address_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>email_address<span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     join_from<span class="token punctuation">(</span>address_table<span class="token punctuation">,</span> u_subq<span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     order_by<span class="token punctuation">(</span>u_subq<span class="token punctuation">.</span>c<span class="token punctuation">.</span>name<span class="token punctuation">,</span> address_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>email_address<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">with</span> engine<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> conn<span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     result <span class="token operator">=</span> conn<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>stmt<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'sandy'</span><span class="token punctuation">,</span> <span class="token string">'sandy@sqlalchemy.org'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'sandy'</span><span class="token punctuation">,</span><span class="token string">'sandy@squirrelpower.org'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
<span class="token punctuation">(</span><span class="token string">'spongebob'</span><span class="token punctuation">,</span> <span class="token string">'spongebob@sqlalchemy.org'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre></div><br> <h2 id="exists-subqueries"><a href="#exists-subqueries" class="header-anchor">#</a> EXISTS Subqueries</h2> <p>SQLAlchemy creates an <code>Exists</code> object through the <code>SelectBase.exists()</code> method to implement the <code>EXISTS</code> clause.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token comment"># subq is a Exists type</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> subq <span class="token operator">=</span> <span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     select<span class="token punctuation">(</span>func<span class="token punctuation">.</span>count<span class="token punctuation">(</span>address_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     where<span class="token punctuation">(</span>user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token operator">==</span> address_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>user_id<span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     group_by<span class="token punctuation">(</span>address_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>user_id<span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     having<span class="token punctuation">(</span>func<span class="token punctuation">.</span>count<span class="token punctuation">(</span>address_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>subq<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
EXISTS (SELECT count(address.id) AS count_1 
FROM address, user_account 
WHERE user_account.id = address.user_id GROUP BY address.user_id 
HAVING count(address.id) &gt; :count_2)
&quot;&quot;&quot;</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">with</span> engine<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> conn<span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     result <span class="token operator">=</span> conn<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         select<span class="token punctuation">(</span>user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span>subq<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'sandy'</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre></div><p>The <code>EXISTS</code> clause is more often used in a non-negated form by the way.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># This is a query to select usernames that do not have an email address.</span>
<span class="token comment"># Take a look at the part where the '~' operator is used.&quot;</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> subq <span class="token operator">=</span> <span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     select<span class="token punctuation">(</span>address_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     where<span class="token punctuation">(</span>user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span><span class="token builtin">id</span> <span class="token operator">==</span> address_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>user_id<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> stmt <span class="token operator">=</span> select<span class="token punctuation">(</span>user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">.</span>where<span class="token punctuation">(</span><span class="token operator">~</span>subq<span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>stmt<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
SELECT user_account.id 
FROM user_account 
WHERE NOT (EXISTS (SELECT count(address.id) AS count_1 
FROM address 
WHERE user_account.id = address.user_id GROUP BY address.user_id 
HAVING count(address.id) &gt; :count_2))
&quot;&quot;&quot;</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">with</span> engine<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> conn<span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     result <span class="token operator">=</span> conn<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>stmt<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'patrick'</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre></div><br> <h2 id="dealing-with-sql-functions"><a href="#dealing-with-sql-functions" class="header-anchor">#</a> Dealing with SQL functions.</h2> <p>In the earlier section <a href="#aggregations-group-by-having">Aggregations: GROUP BY, HAVING</a>, the <code>func</code> object, which acts as a factory for creating new <code>Function</code> objects, was introduced. When using syntax like <code>select()</code>, you can pass SQL functions created by the <code>func</code> object as arguments.</p> <ul><li><code>count()</code> : Aggregate functions are used to print the number of rows.<div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token comment"># cnt is a type of  &lt;class 'sqlalchemy.sql.functions.count'&gt;.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> cnt <span class="token operator">=</span> func<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>select<span class="token punctuation">(</span>cnt<span class="token punctuation">)</span><span class="token punctuation">.</span>select_from<span class="token punctuation">(</span>user_table<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
SELECT count(*) AS count_1FROM user_account
&quot;&quot;&quot;</span>
</code></pre></div></li> <li><code>lower()</code> : String functions are used to convert strings to lowercase.<div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>select<span class="token punctuation">(</span>func<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token string">&quot;A String With Much UPPERCASE&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
SELECT lower(:lower_2) AS lower_1
&quot;&quot;&quot;</span>
</code></pre></div></li> <li><code>now()</code> : There is also a function that returns the current time and date. This function is commonly used, so SQLAlchemy helps in easily rendering it across different backends.<div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> stmt <span class="token operator">=</span> select<span class="token punctuation">(</span>func<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">with</span> engine<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> conn<span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     result <span class="token operator">=</span> conn<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>stmt<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">[</span><span class="token punctuation">(</span>datetime<span class="token punctuation">.</span>datetime<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre></div></li></ul> <p>Different database backends have SQL functions with different names. Therefore, <code>func</code> allows access to any name in its namespace, automatically interpreting that name as an SQL function and rendering it.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token comment"># A data type of crazy_function is Function.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> crazy_function <span class="token operator">=</span> func<span class="token punctuation">.</span>some_crazy_function<span class="token punctuation">(</span>user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>fullname<span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>select<span class="token punctuation">(</span>crazy_function<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
SELECT some_crazy_function(user_account.name, :some_crazy_function_2) AS some_crazy_function_1
FROM user_account
&quot;&quot;&quot;</span>
</code></pre></div><p>Meanwhile, SQLAlchemy provides appropriate data types for commonly used SQL functions like <code>count</code>, <code>now</code>, <code>max</code>, <code>concat</code>, etc., specific to each backend.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> sqlalchemy<span class="token punctuation">.</span>dialects <span class="token keyword">import</span> postgresql
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>select<span class="token punctuation">(</span>func<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>dialect<span class="token operator">=</span>postgresql<span class="token punctuation">.</span>dialect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
SELECT now() AS now_1
&quot;&quot;&quot;</span>

<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> sqlalchemy<span class="token punctuation">.</span>dialects <span class="token keyword">import</span> oracle
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>select<span class="token punctuation">(</span>func<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>dialect<span class="token operator">=</span>oracle<span class="token punctuation">.</span>dialect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
SELECT CURRENT_TIMESTAMP AS now_1 FROM DUAL
&quot;&quot;&quot;</span>
</code></pre></div><br> <h3 id="functions-have-return-types"><a href="#functions-have-return-types" class="header-anchor">#</a> Functions Have Return Types</h3> <blockquote><p>I did not understand the part about 'Functions Have Return Types' in the original text.
If anyone understands this, please contribute to this section. Thank you.</p></blockquote> <br> <h3 id="built-in-functions-have-pre-configured-return-types"><a href="#built-in-functions-have-pre-configured-return-types" class="header-anchor">#</a> Built-in Functions Have Pre-Configured Return Types</h3> <blockquote><p>I did not understand the part about 'Built-in Functions Have Pre-Configured Return Types' in the original text.
If anyone understands this, please contribute to this section. Thank you.</p></blockquote> <br> <h3 id="window-functions"><a href="#window-functions" class="header-anchor">#</a> WINDOW Functions</h3> <p>Window functions are similar to <code>GROUP BY</code>, created to easily define relationships between rows.</p> <p>In SQLAlchemy, among all SQL functions created by the <code>func</code> namespace, there is the <code>FunctionElement.over()</code> method, which implements the <code>OVER</code> clause.</p> <p>One of the window functions is <code>row_number()</code>, which counts the number of rows. You can group each row by username and then number the email addresses within each group.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token comment"># The FunctionElement.over.partition_by parameter is used</span>
<span class="token comment"># to render the PARTITION BY clause in the OVER clause.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> stmt <span class="token operator">=</span> select<span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     func<span class="token punctuation">.</span>row_number<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>over<span class="token punctuation">(</span>partition_by<span class="token operator">=</span>user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     address_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>email_address
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>select_from<span class="token punctuation">(</span>user_table<span class="token punctuation">)</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>address_table<span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">with</span> engine<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> conn<span class="token punctuation">:</span>  
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     result <span class="token operator">=</span> conn<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>stmt<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'sandy'</span><span class="token punctuation">,</span> <span class="token string">'sandy@sqlalchemy.org'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
 <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'sandy'</span><span class="token punctuation">,</span> <span class="token string">'sandy@squirrelpower.org'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
 <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'spongebob'</span><span class="token punctuation">,</span> <span class="token string">'spongebob@sqlalchemy.org'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre></div><p><code>FunctionElement.over.order_by</code> can be used to apply an <code>ORDER BY</code> clause.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> stmt <span class="token operator">=</span> select<span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     func<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>over<span class="token punctuation">(</span>order_by<span class="token operator">=</span>user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     address_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>email_address<span class="token punctuation">)</span><span class="token punctuation">.</span>select_from<span class="token punctuation">(</span>user_table<span class="token punctuation">)</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>address_table<span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">with</span> engine<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> conn<span class="token punctuation">:</span>  
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     result <span class="token operator">=</span> conn<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>stmt<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'sandy'</span><span class="token punctuation">,</span> <span class="token string">'sandy@sqlalchemy.org'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
 <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'sandy'</span><span class="token punctuation">,</span> <span class="token string">'sandy@squirrelpower.org'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
 <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'spongebob'</span><span class="token punctuation">,</span> <span class="token string">'spongebob@sqlalchemy.org'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre></div><br> <h3 id="special-modifiers-like-within-group-filter"><a href="#special-modifiers-like-within-group-filter" class="header-anchor">#</a> Special Modifiers like WITHIN GROUP, FILTER</h3> <p>The SQL clause <code>WITHIN GROUP</code> is used with ordered sets or hypothetical sets along with aggregate functions.</p> <p>Common ordered set functions include <code>percentile_cont()</code> and <code>rank()</code>.</p> <p>In SQLAlchemy, functions such as <code>rank</code>, <code>dense_rank</code>, <code>percentile_count</code>, and <code>percentile_disc</code> are implemented, each with the <code>FunctionElement</code>.<code>within_group()</code> method.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     func<span class="token punctuation">.</span>unnest<span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         func<span class="token punctuation">.</span>percentile_disc<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.25</span><span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span><span class="token number">0.75</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>within_group<span class="token punctuation">(</span>user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
unnest(percentile_disc(:percentile_disc_1) WITHIN GROUP (ORDER BY user_account.name))
&quot;&quot;&quot;</span>
</code></pre></div><p>Some backends support the &quot;FILTER&quot; modifier, which can be utilized through the <code>FunctionElement.filter()</code> method in SQLAlchemy.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> stmt <span class="token operator">=</span> select<span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     func<span class="token punctuation">.</span>count<span class="token punctuation">(</span>address_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>email_address<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">'sandy'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     func<span class="token punctuation">.</span>count<span class="token punctuation">(</span>address_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>email_address<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">filter</span><span class="token punctuation">(</span>user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">'spongebob'</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span><span class="token punctuation">.</span>select_from<span class="token punctuation">(</span>user_table<span class="token punctuation">)</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>address_table<span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">with</span> engine<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> conn<span class="token punctuation">:</span>  
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     result <span class="token operator">=</span> conn<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>stmt<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token builtin">all</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token triple-quoted-string string">&quot;&quot;&quot;
SELECT count(address.email_address) FILTER (WHERE user_account.name = ?) AS anon_1,
count(address.email_address) FILTER (WHERE user_account.name = ?) AS anon_2
FROM user_account JOIN address ON user_account.id = address.user_id
&quot;&quot;&quot;</span>

<span class="token punctuation">(</span><span class="token string">'sandy'</span><span class="token punctuation">,</span> <span class="token string">'spongebob'</span><span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre></div><br> <h3 id="table-valued-functions"><a href="#table-valued-functions" class="header-anchor">#</a> Table-Valued Functions</h3> <blockquote><p>I did not understand the part about 'Table-Valued Functions' in the original text.
If anyone understands this, please contribute to this section. Thank you.</p></blockquote> <br> <h3 id="column-value-functions-or-scalar-column-table-valued-functions"><a href="#column-value-functions-or-scalar-column-table-valued-functions" class="header-anchor">#</a> Column Value Functions or Scalar Column (Table Valued Functions)</h3> <p>One of the special syntaxes supported by Oracle and PostgreSQL is functions set in the FROM clause. Examples in PostgreSQL include <code>json_array_elements()</code>, <code>json_object_keys()</code>, <code>json_each_text()</code>, and <code>json_each()</code>.</p> <p>SQLAlchemy refers to these functions as column values and applies them using the <code>FunctionElement.column_valued()</code> specifier on a <code>Function</code> object.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> sqlalchemy <span class="token keyword">import</span> select<span class="token punctuation">,</span> func
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> stmt <span class="token operator">=</span> select<span class="token punctuation">(</span>func<span class="token punctuation">.</span>json_array_elements<span class="token punctuation">(</span><span class="token string">'[&quot;one&quot;, &quot;two&quot;]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>column_valued<span class="token punctuation">(</span><span class="token string">&quot;x&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>stmt<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
SELECT x
FROM json_array_elements(:json_array_elements_1) AS x
&quot;&quot;&quot;</span>
</code></pre></div><p>Column value functions can also be used in Oracle as custom SQL functions, as shown below.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> sqlalchemy<span class="token punctuation">.</span>dialects <span class="token keyword">import</span> oracle
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> stmt <span class="token operator">=</span> select<span class="token punctuation">(</span>func<span class="token punctuation">.</span>scalar_strings<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>column_valued<span class="token punctuation">(</span><span class="token string">&quot;s&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>stmt<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>dialect<span class="token operator">=</span>oracle<span class="token punctuation">.</span>dialect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
SELECT COLUMN_VALUE s
FROM TABLE (scalar_strings(:scalar_strings_1)) s
&quot;&quot;&quot;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      
      <a href="/sqlalchemy-for-pythonist/en/tutorial/4. Working with Database Metadata.html" class="prev">
        Working with Database Metadata
      </a></span> <span class="next"><a href="/sqlalchemy-for-pythonist/en/tutorial/5.2. Inserting Rows Using Core.html">
        Inserting Rows Using Core
      </a>
      
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/sqlalchemy-for-pythonist/assets/js/app.8473826e.js" defer></script><script src="/sqlalchemy-for-pythonist/assets/js/2.98979e96.js" defer></script><script src="/sqlalchemy-for-pythonist/assets/js/15.dca0d300.js" defer></script>
  </body>
</html>
