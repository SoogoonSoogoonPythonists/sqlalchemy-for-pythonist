<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Inserting Rows Using Core | SQLAlchemy for Python Developers</title>
    <meta name="generator" content="VuePress 1.9.7">
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-SNPCYHY4R2"></script>
    <script>window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-SNPCYHY4R2');</script>
    <meta name="description" content="This is a document that simplifies SQLAlchemy for easy understanding.">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="google-site-verification" content="wjX_mSoZBgO9SZMvjr96yOjo6n3_7pS8xNdmzDl1ESw">
    
    <link rel="preload" href="/sqlalchemy-for-pythonist/assets/css/0.styles.177fd922.css" as="style"><link rel="preload" href="/sqlalchemy-for-pythonist/assets/js/app.8473826e.js" as="script"><link rel="preload" href="/sqlalchemy-for-pythonist/assets/js/2.98979e96.js" as="script"><link rel="preload" href="/sqlalchemy-for-pythonist/assets/js/16.69771a0f.js" as="script"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/10.e7fb4c80.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/11.051ae6e1.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/12.7b93e986.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/13.8d014a70.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/14.138cd924.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/15.dca0d300.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/17.66ba2d35.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/18.760e3a59.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/19.7b4a8a4e.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/20.adec2767.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/21.c59b443d.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/22.f84628fa.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/23.2c4a7cf3.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/24.7785bb30.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/25.dc95a31e.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/26.a287ef6a.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/27.a111ddcb.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/28.b809fce0.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/29.7029d8fa.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/3.2e213720.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/30.b93101cb.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/31.363734c1.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/4.51c0545f.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/5.220df36c.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/6.345e52dd.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/7.a15a95f4.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/8.006f2d84.js"><link rel="prefetch" href="/sqlalchemy-for-pythonist/assets/js/9.7948c093.js">
    <link rel="stylesheet" href="/sqlalchemy-for-pythonist/assets/css/0.styles.177fd922.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/sqlalchemy-for-pythonist/en/" class="home-link router-link-active"><!----> <span class="site-name">SQLAlchemy for Python Developers</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/SoogoonSoogoonPythonists/sqlalchemy-for-pythonist" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/sqlalchemy-for-pythonist/" class="nav-link">
  ko
</a></li><li class="dropdown-item"><!----> <a href="/sqlalchemy-for-pythonist/en/tutorial/5.2. Inserting Rows Using Core.html" class="nav-link">
  en-US
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/SoogoonSoogoonPythonists/sqlalchemy-for-pythonist" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/sqlalchemy-for-pythonist/" class="nav-link">
  ko
</a></li><li class="dropdown-item"><!----> <a href="/sqlalchemy-for-pythonist/en/tutorial/5.2. Inserting Rows Using Core.html" class="nav-link">
  en-US
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><a href="/sqlalchemy-for-pythonist/en/tutorial/" class="sidebar-heading clickable router-link-active open"><span>Tutorial</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/sqlalchemy-for-pythonist/en/tutorial/1. Tutorial Overview.html" class="sidebar-link">Tutorial Overview</a></li><li><a href="/sqlalchemy-for-pythonist/en/tutorial/2. Setting Up a Connection.html" class="sidebar-link">Setting up a Connection</a></li><li><a href="/sqlalchemy-for-pythonist/en/tutorial/3. Executing Transactions and Queries.html" class="sidebar-link">Executing Transactions and Queries</a></li><li><a href="/sqlalchemy-for-pythonist/en/tutorial/4. Working with Database Metadata.html" class="sidebar-link">Working with Database Metadata</a></li><li><a href="/sqlalchemy-for-pythonist/en/tutorial/5.1. Querying Rows Using Core and ORM.html" class="sidebar-link">Querying Rows Using Core and ORM</a></li><li><a href="/sqlalchemy-for-pythonist/en/tutorial/5.2. Inserting Rows Using Core.html" class="active sidebar-link">Inserting Rows Using Core</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/sqlalchemy-for-pythonist/en/tutorial/5.2. Inserting Rows Using Core.html#constructing-sql-expressions-with-insert" class="sidebar-link">Constructing SQL Expressions with insert()</a></li><li class="sidebar-sub-header"><a href="/sqlalchemy-for-pythonist/en/tutorial/5.2. Inserting Rows Using Core.html#executing-the-statement" class="sidebar-link">Executing the Statement</a></li><li class="sidebar-sub-header"><a href="/sqlalchemy-for-pythonist/en/tutorial/5.2. Inserting Rows Using Core.html#passing-insert-parameters-to-connection-execute" class="sidebar-link">Passing INSERT Parameters to Connection.execute()</a></li><li class="sidebar-sub-header"><a href="/sqlalchemy-for-pythonist/en/tutorial/5.2. Inserting Rows Using Core.html#insert-from-select" class="sidebar-link">Insert.from_select()</a></li><li class="sidebar-sub-header"><a href="/sqlalchemy-for-pythonist/en/tutorial/5.2. Inserting Rows Using Core.html#insert-returning" class="sidebar-link">Insert.returning()</a></li></ul></li><li><a href="/sqlalchemy-for-pythonist/en/tutorial/5.3. Modifying and Deleting Rows Using Core.html" class="sidebar-link">Modifying and Deleting Rows Using Core</a></li><li><a href="/sqlalchemy-for-pythonist/en/tutorial/6. Manipulating Data Using ORM.html" class="sidebar-link">Manipulating Data Using ORM</a></li><li><a href="/sqlalchemy-for-pythonist/en/tutorial/7. Working with Related Objects Using ORM.html" class="sidebar-link">Working with Related Objects Using ORM</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="inserting-rows-using-core"><a href="#inserting-rows-using-core" class="header-anchor">#</a> Inserting Rows Using Core</h1> <p>In this chapter, we learn how to INSERT data using the SQLAlchemy Core approach.</p> <br> <h2 id="constructing-sql-expressions-with-insert"><a href="#constructing-sql-expressions-with-insert" class="header-anchor">#</a> Constructing SQL Expressions with <code>insert()</code></h2> <p>First, you can create an INSERT statement like this:</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">from</span> sqlalchemy <span class="token keyword">import</span> insert

<span class="token comment">#  stmt is an instance of the Insert object.</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> stmt <span class="token operator">=</span> insert<span class="token punctuation">(</span>user_table<span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'spongebob'</span><span class="token punctuation">,</span> fullname<span class="token operator">=</span><span class="token string">&quot;Spongebob Squarepants&quot;</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>stmt<span class="token punctuation">)</span>
<span class="token string">'INSERT INTO user_account (name, fullname) VALUES (:name, :fullname)'</span>
</code></pre></div><blockquote><p>Here, user_table is the Table object we created in the previous chapter. We created it as follows.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token keyword">from</span> sqlalchemy <span class="token keyword">import</span> MetaData
<span class="token keyword">from</span> sqlalchemy <span class="token keyword">import</span> Table<span class="token punctuation">,</span> Column<span class="token punctuation">,</span> Integer<span class="token punctuation">,</span> String

metadata <span class="token operator">=</span> MetaData<span class="token punctuation">(</span><span class="token punctuation">)</span>
user_table <span class="token operator">=</span> Table<span class="token punctuation">(</span>
    <span class="token string">'user_account'</span><span class="token punctuation">,</span>
    metadata<span class="token punctuation">,</span>
    Column<span class="token punctuation">(</span><span class="token string">'id'</span><span class="token punctuation">,</span> Integer<span class="token punctuation">,</span> primary_key<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Column<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span> String<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    Column<span class="token punctuation">(</span><span class="token string">'fullname'</span><span class="token punctuation">,</span> String<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
</code></pre></div></blockquote> <p>Looking at <code>stmt</code>, you'll notice that the parameters have not yet been mapped.
This can be checked after <code>compile()</code> it, as shown next.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> compiled <span class="token operator">=</span> stmt<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>compiled<span class="token punctuation">.</span>params<span class="token punctuation">)</span>
<span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'spongebob'</span><span class="token punctuation">,</span> <span class="token string">'fullname'</span><span class="token punctuation">:</span> <span class="token string">'Spongebob Squarepants'</span><span class="token punctuation">}</span>
</code></pre></div><br> <h2 id="executing-the-statement"><a href="#executing-the-statement" class="header-anchor">#</a> Executing the Statement</h2> <p>Now, let's execute the INSERT statement we created above using the Core approach.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">with</span> engine<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> conn<span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     result <span class="token operator">=</span> conn<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>stmt<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     conn<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># The above code executes the following query.</span>

BEGIN <span class="token punctuation">(</span>implicit<span class="token punctuation">)</span>
INSERT INTO user_account <span class="token punctuation">(</span>name<span class="token punctuation">,</span> fullname<span class="token punctuation">)</span> VALUES <span class="token punctuation">(</span>?<span class="token punctuation">,</span> ?<span class="token punctuation">)</span>
<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token punctuation">(</span><span class="token string">'spongebob'</span><span class="token punctuation">,</span> <span class="token string">'Spongebob Squarepants'</span><span class="token punctuation">)</span>
COMMIT
</code></pre></div><p>What information does the result contain, which is obtained from the return value of <code>conn.execute(stmt)</code>?
result is a <a href="https://docs.sqlalchemy.org/en/20/core/connections.html#sqlalchemy.engine.CursorResult" target="_blank" rel="noopener noreferrer"><code>CursorResult</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> object.
It holds various information about the execution results, particularly the <a href="https://docs.sqlalchemy.org/en/20/core/connections.html#sqlalchemy.engine.Row" target="_blank" rel="noopener noreferrer"><code>Row</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> objects that contain data rows.</p> <p>Since we have just inserted data, we can check the primary key value of the inserted data as follows.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> result<span class="token punctuation">.</span>inserted_primary_key  <span class="token comment"># This is also a Row object.</span>
<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">)</span>  <span class="token comment"># As the primary key can be composed of multiple columns, it is represented as a tuple.</span>
</code></pre></div><br> <h2 id="passing-insert-parameters-to-connection-execute"><a href="#passing-insert-parameters-to-connection-execute" class="header-anchor">#</a> Passing INSERT Parameters to <code>Connection.execute()</code></h2> <p>Above, we created a statement that included <code>values</code> along with <code>insert</code>.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> stmt <span class="token operator">=</span> insert<span class="token punctuation">(</span>user_table<span class="token punctuation">)</span><span class="token punctuation">.</span>values<span class="token punctuation">(</span>name<span class="token operator">=</span><span class="token string">'spongebob'</span><span class="token punctuation">,</span> fullname<span class="token operator">=</span><span class="token string">&quot;Spongebob Squarepants&quot;</span><span class="token punctuation">)</span>
</code></pre></div><p>However, besides this method, you can also execute an INSERT statement by passing parameters to the <code>Connection.execute()</code> method. The official documentation suggests this as a more common approach.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">with</span> engine<span class="token punctuation">.</span>connect<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> conn<span class="token punctuation">:</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     result <span class="token operator">=</span> conn<span class="token punctuation">.</span>execute<span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         insert<span class="token punctuation">(</span>user_table<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         <span class="token punctuation">[</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>             <span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;sandy&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;fullname&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Sandy Cheeks&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>             <span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;patrick&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;fullname&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;Patrick Star&quot;</span><span class="token punctuation">}</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>         <span class="token punctuation">]</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     conn<span class="token punctuation">.</span>commit<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><blockquote><p>The official documentation also explains how to execute statements including subqueries in a separate section. However, it has been deemed not entirely suitable for the tutorial content and is not included in this text.
For those interested in this topic, please refer to the <a href="https://docs.sqlalchemy.org/en/20/tutorial/data_insert.html#insert-usually-generates-the-values-clause-automatically" target="_blank" rel="noopener noreferrer">original documentation<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p></blockquote> <br> <h2 id="insert-from-select"><a href="#insert-from-select" class="header-anchor">#</a> <code>Insert.from_select()</code></h2> <p>Sometimes you need a query to INSERT rows that are received from a SELECT statement, as in the following example.</p> <p>Such cases can be written as shown in the following code.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> select_stmt <span class="token operator">=</span> select<span class="token punctuation">(</span>user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span> user_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>name <span class="token operator">+</span> <span class="token string">&quot;@aol.com&quot;</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> insert_stmt <span class="token operator">=</span> insert<span class="token punctuation">(</span>address_table<span class="token punctuation">)</span><span class="token punctuation">.</span>from_select<span class="token punctuation">(</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>     <span class="token punctuation">[</span><span class="token string">&quot;user_id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;email_address&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> select_stmt
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>insert_stmt<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
INSERT INTO address (user_id, email_address)
SELECT user_account.id, user_account.name || :name_1 AS anon_1
FROM user_account
&quot;&quot;&quot;</span>
</code></pre></div><br> <h2 id="insert-returning"><a href="#insert-returning" class="header-anchor">#</a> <code>Insert.returning()</code></h2> <p>There are situations where you need to receive the value of the processed rows from the database after query processing. This is known as the RETURNING syntax.
For an introduction to this, it would be good to read <a href="https://wiki.postgresql.org/wiki/UPSERT" target="_blank" rel="noopener noreferrer">this wiki<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>In SQLAlchemy Core, this <code>RETURNING</code> syntax can be written as follows.</p> <div class="language-python extra-class"><pre class="language-python"><code><span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> insert_stmt <span class="token operator">=</span> insert<span class="token punctuation">(</span>address_table<span class="token punctuation">)</span><span class="token punctuation">.</span>returning<span class="token punctuation">(</span>address_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span> address_table<span class="token punctuation">.</span>c<span class="token punctuation">.</span>email_address<span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>insert_stmt<span class="token punctuation">)</span>
<span class="token triple-quoted-string string">&quot;&quot;&quot;
INSERT INTO address (id, user_id, email_address)
VALUES (:id, :user_id, :email_address)
RETURNING address.id, address.email_address
&quot;&quot;&quot;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/sqlalchemy-for-pythonist/en/tutorial/5.1. Querying Rows Using Core and ORM.html" class="prev">
        Querying Rows Using Core and ORM
      </a></span> <span class="next"><a href="/sqlalchemy-for-pythonist/en/tutorial/5.3. Modifying and Deleting Rows Using Core.html">
        Modifying and Deleting Rows Using Core
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/sqlalchemy-for-pythonist/assets/js/app.8473826e.js" defer></script><script src="/sqlalchemy-for-pythonist/assets/js/2.98979e96.js" defer></script><script src="/sqlalchemy-for-pythonist/assets/js/16.69771a0f.js" defer></script>
  </body>
</html>
